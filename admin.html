<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PayCash Admin Panel</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        h1 { text-align: center; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background-color: #4CAF50; color: white; }
        #adminArea { margin-top: 20px; font-size: 18px; color: red; text-align: center; }
    </style>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
    <h1>PayCash Admin Panel</h1>

    <div id="adminArea">Loading...</div>

    <h2>Users List</h2>
    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Points</th>
                <th>Ref ID</th>
                <th>Referral From</th>
            </tr>
        </thead>
        <tbody id="usersTable"></tbody>
    </table>

    <h2>Withdraw Requests</h2>
    <table>
        <thead>
            <tr>
                <th>User Name</th>
                <th>Points</th>
                <th>Method</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody id="withdrawsTable"></tbody>
    </table>

    <script>
    // Firebase Config - Replace with your config if different
    const firebaseConfig = {
      apiKey: "AIzaSyC-Hy8VMaw471sxHt3jStxEyyEOTsOjoY0",
      authDomain: "paycash-92256.firebaseapp.com",
      databaseURL: "https://paycash-92256-default-rtdb.firebaseio.com",
      projectId: "paycash-92256",
      storageBucket: "paycash-92256.firebasestorage.app",
      messagingSenderId: "690964863262",
      appId: "1:690964863262:web:800a7c905ee23cd99d910f",
      measurementId: "G-5JPB45M5N6"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    // Admin Panel JS
    firebase.auth().onAuthStateChanged(async (user) => {
        if (!user) {
            window.location.href = "login.html";
            return;
        }

        try {
            const snap = await firebase.database().ref('users/' + user.uid).once('value');
            const data = snap.val();

            if (!data || data.isAdmin !== true) {
                document.getElementById('adminArea').innerText = "Access denied.";
                return;
            }

            document.getElementById('adminArea').innerText = "Welcome Admin: " + (data.meta?.name || data.email);

            // Load users
            const usersSnap = await firebase.database().ref('users').once('value');
            const usersData = usersSnap.val();

            const withdrawsSnap = await firebase.database().ref('withdraws').once('value');
            const withdrawsData = withdrawsSnap.val();

            let usersHTML = '';
            for (let uid in usersData) {
                const u = usersData[uid];
                usersHTML += `<tr>
                    <td>${u.meta?.name || ''}</td>
                    <td>${u.email}</td>
                    <td>${u.points}</td>
                    <td>${u.refId}</td>
                    <td>${u.referralFrom || '-'}</td>
                </tr>`;
            }
            document.getElementById('usersTable').innerHTML = usersHTML;

            let withdrawHTML = '';
            for (let wid in withdrawsData) {
                const w = withdrawsData[wid];
                withdrawHTML += `<tr>
                    <td>${w.userName || ''}</td>
                    <td>${w.points}</td>
                    <td>${w.method}</td>
                    <td>${w.status || 'Pending'}</td>
                </tr>`;
            }
            document.getElementById('withdrawsTable').innerHTML = withdrawHTML;

        } catch (error) {
    console.error("Admin panel error:", error);
    // UI me message na dikhaye
    // document.getElementById('adminArea').innerText = ""; // optional
        }
    });
    </script>
</body>
</html>